controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    do_one_pattern()
})
function do_one_pattern () {
    q1 = sprites.create(img`
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        `, SpriteKind.Player)
    set_left_and_top(q1, 20, 0)
    q2 = sprites.create(img`
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        `, SpriteKind.Player)
    set_left_and_top(q2, 80, 0)
    q3 = sprites.create(img`
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        `, SpriteKind.Player)
    set_left_and_top(q3, 80, 60)
    q4 = sprites.create(img`
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        ............................................................
        `, SpriteKind.Player)
    set_left_and_top(q4, 20, 60)
    fillQ1randomly()
    reflect_q1_to_q234()
}
controller.A.onEvent(ControllerButtonEvent.Pressed, function () {
    create_colors_list(nColors)
    do_one_pattern()
})
function  fillQ1randomly () {
    for (let m = 0; m <= q1.height / cell_size; m++) {
        for (let n = 0; n <= q1.width / cell_size; n++) {
            rColor = colors[randint(0, colors.length - 1)]
            for (let cell_i = 0; cell_i < cell_size; cell_i++) {
                for (let cell_j = 0; cell_j < cell_size; cell_j++) {
                    q1.image.setPixel(cell_size* n + cell_j, cell_size * m + cell_i, rColor)
                }
            }
        }
    }
}
function set_left_and_top (mySprite: Sprite, left: number, top: number) {
    mySprite.left = left
    mySprite.top = top
}
function get_number_of_colors () {
    ndx = 0
    while (!(game.ask("number of colors: " + possible_nColors[ndx]))) {
        ndx += 1
        ndx= ndx % possible_nColors.length
    }
    return possible_nColors[ndx]
}
function create_colors_list (n: number) {
    colors = []
    for (let index = 0; index < n; index++) {
        try_color = randint(1, 15)
        while (colors.indexOf(try_color) > -1) {
            try_color = randint(1, 15)
        }
        colors.push(try_color)
    }
}
function reflect_q1_to_q234 () {
    for (let i = 0; i <= q1.height - 1; i++) {
        for (let j = 0; j <= q1.width - 1; j++) {
            q2.image.setPixel(q2.width - j - 1, i, q1.image.getPixel(j, i))
            q3.image.setPixel(q3.width - j - 1, q3.height - i - 1, q1.image.getPixel(j, i))
            q4.image.setPixel(j, q4.height - i - 1, q1.image.getPixel(j, i))
        }
    }
}
controller.A.onEvent(ControllerButtonEvent.Repeated, function () {
    cell_size = get_pixels_per_cell_side()
    nColors = get_number_of_colors()
    create_colors_list(nColors)
    do_one_pattern()
})
function get_pixels_per_cell_side () {
    let ndx = 0
    while (!(game.ask("pixels in cell side: " + possible_cell_sizes[ndx]))) {
        ndx += 1
        ndx = ndx % possible_cell_sizes.length
    }
    return possible_cell_sizes[ndx]
}

let q4: Sprite = null
let q3: Sprite = null
let q2: Sprite = null
let q1: Sprite = null
let colors: number[] = []
let possible_nColors: number[] = []
let possible_cell_sizes: number[] = []
let try_color: number = 0
let rColor: number = 0
let cell_size: number = 0
let nColors: number = 0
let ndx:  number = 0
nColors = 2
cell_size = 8
rColor = 0
try_color = 0
possible_cell_sizes = [2, 4, 8, 16, 20]
possible_nColors = [2, 3, 3, 4, 5]
colors = []
create_colors_list(nColors)
do_one_pattern()
